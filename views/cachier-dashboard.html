<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reservation Approval - Cashier</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
         :root {
            --primary-color: #007bff;
            /* Bootstrap Primary */
            --success-color: #28a745;
            /* Bootstrap Success */
            --danger-color: #dc3545;
            /* Bootstrap Danger */
            --warning-color: #ffc107;
            /* Bootstrap Warning */
            --text-dark: #1e2387;
            --text-muted: #6c757d;
            --body-bg: linear-gradient(to right, #e3e5fa, #e9efff);
            --card-bg: #ffffff;
            --border-color: #dee2e6;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }
        
        body {
            background: var(--body-bg);
            color: var(--text-dark);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1140px;
            /* Standard container width */
            margin: 0 auto;
            padding: 2rem 1rem;
            /* Responsive padding */
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        .header-title {
            font-size: 1.75rem;
            /* Slightly larger */
            font-weight: 600;
            color: var(--text-dark);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            /* Reduced gap */
            cursor: pointer;
            position: relative;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-color);
            /* Theme color */
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            /* Slightly less bold */
            font-size: 0.9rem;
        }
        
        .user-name {
            font-weight: 500;
            font-size: 0.95rem;
        }
        
        .user-dropdown {
            position: absolute;
            top: calc(100% + 10px);
            /* Added spacing */
            right: 0;
            background: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 5px 15px #0000001a;
            /* Softer shadow */
            padding: 0;
            /* Remove padding, handle with list items */
            width: 220px;
            display: none;
            z-index: 100;
            overflow: hidden;
            /* For rounded corners on items */
        }
        
        .user-dropdown.active {
            display: block;
        }
        
        .user-dropdown-header {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        .user-dropdown-header strong {
            font-weight: 600;
        }
        
        .user-dropdown-header div:last-child {
            font-size: 0.85rem;
            color: var(--text-muted);
        }
        
        .user-dropdown .logout-btn {
            display: flex;
            /* Align icon and text */
            align-items: center;
            gap: 0.5rem;
            width: 100%;
            padding: 0.75rem 1rem;
            text-align: left;
            /* Align text to left */
            background: transparent;
            border-radius: 0;
            /* No radius for list item feel */
            color: var(--danger-color);
            /* Danger color for logout */
            text-decoration: none;
            margin-top: 0;
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .user-dropdown .logout-btn i {
            font-size: 1.1rem;
        }
        
        .user-dropdown .logout-btn:hover {
            background: rgba(var(--danger-rgb), 0.05);
            /* Very subtle hover */
        }
        
        .btn {
            padding: 0.5rem 1rem;
            /* Standardized padding */
            border-radius: 6px;
            /* Softer radius */
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            font-size: 0.9rem;
            display: inline-flex;
            /* For icon alignment */
            align-items: center;
            gap: 0.4rem;
        }
        
        .btn i {
            font-size: 1.1em;
            /* Relative to button font size */
        }
        
        .btn-success {
            background: var(--success-color);
            color: white;
        }
        
        .btn-success:hover {
            background: #1f8037;
            /* Darker success */
        }
        
        .btn-danger {
            background: var(--danger-color);
            color: white;
        }
        
        .btn-danger:hover {
            background: #b02a37;
            /* Darker danger */
        }
        
        .btn-outline-primary {
            /* Changed to btn-outline-primary for better theme consistency */
            background: transparent;
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
        }
        
        .btn-outline-primary:hover {
            background: var(--primary-color);
            color: white;
        }
        
        .btn-outline-secondary {
            background: transparent;
            border: 1px solid var(--text-muted);
            color: var(--text-muted);
        }
        
        .btn-outline-secondary:hover {
            background: var(--text-muted);
            color: white;
        }
        
        .card {
            background: var(--card-bg);
            border-radius: 10px;
            /* Softer radius */
            padding: 1.5rem;
            box-shadow: 0 3px 10px #0000000a;
            /* Softer shadow */
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
            /* Subtle border */
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
            /* Slightly smaller table font */
        }
        
        th,
        td {
            padding: 0.9rem 1rem;
            /* Adjusted padding */
            text-align: left;
            border-bottom: 1px solid #f0f0f0;
            /* Lighter border within table */
            vertical-align: middle;
        }
        
        th {
            font-weight: 600;
            /* Bolder header */
            color: var(--text-dark);
            background-color: #f8f9fa;
            /* Light header bg */
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 0.5px;
        }
        
        tbody tr:hover {
            background-color: #f8f9fa;
        }
        
        .badge {
            padding: 0.35em 0.75em;
            /* Bootstrap 5 badge padding */
            border-radius: 0.375rem;
            /* Bootstrap 5 badge radius */
            font-size: 0.8em;
            /* Relative to parent for consistency */
            font-weight: 600;
            text-transform: capitalize;
        }
        /* Using Bootstrap 5 background/text utility classes for badges for consistency if needed, or define custom: */
        
        .status-badge.bg-success {
            background-color: var(--bs-success-bg-subtle) !important;
            color: var(--bs-success-text-emphasis) !important;
            border: 1px solid var(--bs-success-border-subtle) !important;
        }
        
        .status-badge.bg-warning {
            background-color: var(--bs-warning-bg-subtle) !important;
            color: var(--bs-warning-text-emphasis) !important;
            border: 1px solid var(--bs-warning-border-subtle) !important;
        }
        
        .status-badge.bg-danger {
            background-color: var(--bs-danger-bg-subtle) !important;
            color: var(--bs-danger-text-emphasis) !important;
            border: 1px solid var(--bs-danger-border-subtle) !important;
        }
        
        .status-badge.bg-secondary {
            background-color: var(--bs-secondary-bg-subtle) !important;
            color: var(--bs-secondary-text-emphasis) !important;
            border: 1px solid var(--bs-secondary-border-subtle) !important;
        }
        
        .search-filter {
            display: flex;
            flex-wrap: wrap;
            /* Allow wrapping on small screens */
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .search-filter .form-control,
        .search-filter .form-select {
            /* Target Bootstrap classes */
            padding: 0.6rem 0.8rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 0.9rem;
            flex-grow: 1;
            /* Allow elements to grow */
        }
        
        .search-filter .form-select {
            min-width: 200px;
        }
        /* Prevent select from becoming too small */
        
        .search-filter input[type="text"] {
            min-width: 250px;
        }
        
        .reservation-details-card-header {
            /* Custom class for details card header */
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        .reservation-details-card-header h2 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0;
        }
        
        .reservation-details {
            background: #f8f9fa;
            /* Lighter background for details block */
            border-radius: 8px;
            padding: 1.25rem;
            margin-top: 1rem;
            border: 1px solid #e9ecef;
        }
        
        .reservation-details p {
            margin-bottom: 0.6rem;
            font-size: 0.9rem;
        }
        
        .reservation-details strong {
            color: var(--text-dark);
            font-weight: 500;
            margin-right: 0.5rem;
        }
        
        .reservation-details-actions {
            /* For buttons within the details card */
            text-align: right;
            /* Align buttons to the right */
            margin-top: 1.5rem;
        }
        
        .reservation-details-actions .btn+.btn {
            margin-left: 0.5rem;
        }
        
        .action-buttons {
            display: flex;
            gap: 0.5rem;
            justify-content: flex-start;
            /* Default alignment */
        }
        
        .action-buttons .btn {
            padding: 0.35rem 0.75rem;
            /* Smaller buttons for table actions */
        }
        /* Custom Alert Placeholder Style (if you replace JS alert() later) */
        
        .custom-alert {
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid transparent;
            border-radius: 0.375rem;
        }
        
        .custom-alert-success {
            color: #0f5132;
            background-color: #d1e7dd;
            border-color: #badbcc;
        }
        
        .custom-alert-danger {
            color: #842029;
            background-color: #f8d7da;
            border-color: #f5c2c7;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 1.5rem 1rem;
            }
            header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            .header-title {
                font-size: 1.5rem;
            }
            .search-filter {
                flex-direction: column;
                gap: 0.75rem;
            }
            .search-filter .form-control,
            .search-filter .form-select {
                width: 100%;
                min-width: unset;
            }
            .action-buttons {
                flex-direction: row;
                /* Keep as row, but they might wrap */
                flex-wrap: wrap;
            }
            .action-buttons .btn {
                width: auto;
                margin-bottom: 0.5rem;
                /* Add some bottom margin if they wrap */
            }
            table,
            thead,
            tbody,
            th,
            td,
            tr {
                display: block;
            }
            /* Force table to not be a table anymore */
            thead tr {
                position: absolute;
                top: -9999px;
                left: -9999px;
            }
            /* Hide table headers */
            tr {
                border: 1px solid #ccc;
                margin-bottom: 0.5rem;
                border-radius: 8px;
                background: var(--card-bg);
            }
            td {
                border: none;
                border-bottom: 1px solid #eee;
                position: relative;
                padding-left: 50%;
                /* Create space for label */
                white-space: normal;
                text-align: right;
                /* Align content to the right */
            }
            td:before {
                /* Add data-* attribute for labels */
                position: absolute;
                top: 50%;
                left: 10px;
                transform: translateY(-50%);
                width: 45%;
                padding-right: 10px;
                white-space: nowrap;
                text-align: left;
                /* Align label to the left */
                font-weight: 600;
                content: attr(data-label);
            }
            .reservation-details-actions {
                text-align: center;
            }
            /* Center buttons on mobile in details card */
        }
        
        @media (max-width: 480px) {
            .action-buttons {
                flex-direction: column;
            }
            .action-buttons .btn {
                width: 100%;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1 class="header-title">Reservation Approval</h1>
            <div class="user-info" id="userInfo" title="User Account">
                <div class="user-avatar">CA</div>
                <div class="user-name">Cashier</div>
                <i class="bi bi-caret-down-fill" style="font-size: 0.8rem;"></i>
                <div class="user-dropdown" id="userDropdown">
                    <div class="user-dropdown-header">
                        <strong>Cashier Name</strong>
                        <div>cashier@example.com</div>
                    </div>
                    <a href="#" class="logout-btn" id="logoutBtn">
                        <i class="bi bi-box-arrow-left"></i> Logout
                    </a>
                </div>
            </div>
        </header>

        <div class="search-filter card">
            <!-- Wrapped search in a card for better grouping -->
            <select id="filterStatus" class="form-select">
        <option value="all">All Reservations</option>
        <option value="pending" selected>Pending Approval</option>
        <option value="approved">Approved</option>
        <option value="rejected">Rejected</option>
      </select>
            <input type="text" id="searchReservations" class="form-control" placeholder="Search by ID, Name, Trip...">
        </div>

        <div class="card table-responsive-md">
            <!-- Added table-responsive-md for better small screen handling before full collapse -->
            <table id="reservationsTable">
                <thead>
                    <tr>
                        <th>Res. ID</th>
                        <th>Customer</th>
                        <th>Trip Details</th>
                        <th>Date</th>
                        <th>Status</th>
                        <th class="text-center">Actions</th>
                        <!-- Centered actions header -->
                    </tr>
                </thead>
                <tbody>
                    <!-- Reservations will be loaded here -->
                    <!-- Example of how td should be structured for mobile labels:
            <tr>
                <td data-label="Res. ID">101</td>
                <td data-label="Customer">John Doe</td>
                <td data-label="Trip Details">City A to City B<br><small>10:00 AM</small></td>
                <td data-label="Date">2023-10-26</td>
                <td data-label="Status"><span class="badge status-badge bg-warning">Pending</span></td>
                <td data-label="Actions" class="text-center">
                    <div class="action-buttons justify-content-center">
                        <button class="btn btn-sm btn-success approve-btn" data-id="101"><i class="bi bi-check-circle"></i> Approve</button>
                        <button class="btn btn-sm btn-danger reject-btn" data-id="101"><i class="bi bi-x-circle"></i> Reject</button>
                    </div>
                </td>
            </tr>
           -->
                </tbody>
            </table>
        </div>

        <!-- Reservation Details Card (hidden by default) -->
        <div class="card" id="reservationDetailsCard" style="display: none;">
            <div class="reservation-details-card-header">
                <h2>Reservation Details</h2>
                <button class="btn btn-sm btn-outline-secondary" id="closeDetailsBtn" title="Close Details">
          <i class="bi bi-x-lg"></i> Close
        </button>
            </div>

            <div id="reservationDetailsContent">
                <!-- Details will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        let reservations = []; // Assume this gets populated from API

        document.addEventListener('DOMContentLoaded', async function() {
            // Mock user info population
            const userInfoDiv = document.querySelector('#userDropdown div:first-child');
            const userEmailDiv = document.querySelector('#userDropdown div:nth-child(2)');
            // In a real app, fetch this or get from a global user object
            // userInfoDiv.innerHTML = `<strong>Cashier Test</strong>`; 
            // userEmailDiv.textContent = `cashier.test@example.com`;

            try {
                const res = await fetch('/api/payments/reservations', { // Make sure this endpoint is correct
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                if (!res.ok) {
                    throw new Error(`HTTP error! status: ${res.status}`);
                }
                reservations = await res.json();
                loadReservations('pending'); // Load pending by default
            } catch (error) {
                // Use a more user-friendly way to show errors if possible, instead of alert()
                console.error('Failed to load reservations:', error);
                const tbody = document.querySelector('#reservationsTable tbody');
                if (tbody) tbody.innerHTML = `<tr><td colspan="6" class="text-center text-danger">Failed to load reservations from server. Please try again later.</td></tr>`;
                // You could show a toast notification here too.
            }
        });

        function loadReservations(filter = 'pending') {
            const tbody = document.querySelector('#reservationsTable tbody');
            tbody.innerHTML = ''; // Clear existing rows

            const searchTerm = document.getElementById('searchReservations').value.toLowerCase();

            const filteredReservations = reservations.filter(r => {
                const matchesFilter = filter === 'all' ||
                    (filter === 'pending' && r.statutPaiement === 'unpaid') ||
                    (filter === 'approved' && r.statutPaiement === 'paid') ||
                    (filter === 'rejected' && r.statutPaiement === 'rejected');

                const matchesSearch = !searchTerm ||
                    r.idReservation.toString().includes(searchTerm) ||
                    (r.passagerNom && r.passagerNom.toLowerCase().includes(searchTerm)) ||
                    (r.passagerPrenom && r.passagerPrenom.toLowerCase().includes(searchTerm)) ||
                    (r.depart && r.depart.toLowerCase().includes(searchTerm)) ||
                    (r.destination && r.destination.toLowerCase().includes(searchTerm));

                return matchesFilter && matchesSearch;
            });

            if (filteredReservations.length === 0) {
                tbody.innerHTML = `<tr><td colspan="6" class="text-center text-muted p-4">No reservations found matching your criteria.</td></tr>`;
                return;
            }

            filteredReservations.forEach(reservation => {
                const row = document.createElement('tr');
                let statusBadgeClass = 'secondary';
                let statusText = reservation.statutPaiement;

                if (reservation.statutPaiement === 'paid') {
                    statusBadgeClass = 'success';
                    statusText = 'Approved';
                } else if (reservation.statutPaiement === 'unpaid') {
                    statusBadgeClass = 'warning';
                    statusText = 'Pending';
                } else if (reservation.statutPaiement === 'rejected') {
                    statusBadgeClass = 'danger';
                    statusText = 'Rejected';
                }

                let actionBtns = reservation.statutPaiement === 'unpaid' ? `
            <div class="action-buttons justify-content-center">
                <button class="btn btn-sm btn-success approve-btn" data-id="${reservation.idReservation}" title="Approve Payment">
                <i class="bi bi-check-circle-fill"></i> Approve
                </button>
                <button class="btn btn-sm btn-danger reject-btn" data-id="${reservation.idReservation}" title="Reject Payment">
                <i class="bi bi-x-circle-fill"></i> Reject
                </button>
            </div>` : `
            <button class="btn btn-sm btn-outline-primary view-btn" data-id="${reservation.idReservation}" title="View Details">
                <i class="bi bi-eye-fill"></i> View
            </button>`;

                // Added data-label attributes for mobile view
                row.innerHTML = `
            <td data-label="Res. ID">${reservation.idReservation}</td>
            <td data-label="Customer">${reservation.passagerNom || 'N/A'} ${reservation.passagerPrenom || ''}</td>
            <td data-label="Trip Details">${reservation.depart  || 'N/A'} to ${reservation.destination || 'N/A'}<br><small class="text-muted">${reservation.heureDepart || 'N/A'}</small></td>
            <td data-label="Date">${reservation.dateReservation ? new Date(reservation.dateReservation).toLocaleDateString() : 'N/A'}</td>
            <td data-label="Status"><span class="badge status-badge bg-${statusBadgeClass}">${statusText}</span></td>
            <td data-label="Actions" class="text-center">${actionBtns}</td>
        `;
                tbody.appendChild(row);
            });

            attachActionHandlers(); // Re-attach handlers after loading
        }

        function attachActionHandlers() {
            document.querySelectorAll('.approve-btn').forEach(btn => {
                const newBtn = btn.cloneNode(true); // Clone to remove old listeners
                btn.parentNode.replaceChild(newBtn, btn);
                newBtn.addEventListener('click', function() {
                    approveReservation(this.getAttribute('data-id'));
                });
            });
            document.querySelectorAll('.reject-btn').forEach(btn => {
                const newBtn = btn.cloneNode(true);
                btn.parentNode.replaceChild(newBtn, btn);
                newBtn.addEventListener('click', function() {
                    rejectReservation(this.getAttribute('data-id'));
                });
            });
            document.querySelectorAll('.view-btn').forEach(btn => {
                const newBtn = btn.cloneNode(true);
                btn.parentNode.replaceChild(newBtn, btn);
                newBtn.addEventListener('click', function() {
                    showReservationDetails(this.getAttribute('data-id'));
                });
            });
        }

        async function updateReservationStatus(reservationId, status) {
            // Helper function to optimistically update UI and then fetch new data
            const reservation = reservations.find(r => r.idReservation == reservationId);
            if (reservation) reservation.statutPaiement = status; // Optimistic update
            loadReservations(document.getElementById('filterStatus').value); // Reload table with current filter

            try {
                const res = await fetch('/api/payments/reservations', { // Fetch fresh list
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                if (!res.ok) throw new Error("Failed to refresh reservations list.");
                reservations = await res.json();
                loadReservations(document.getElementById('filterStatus').value); // Final reload with server data
            } catch (err) {
                console.error("Error refreshing reservations:", err);
                // Potentially revert optimistic update or show error
            }
        }

        async function approveReservation(reservationId) {
            try {
                await fetch(`/api/payments/${reservationId}/paid`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                // Using JS alert for now, replace with custom notification
                alert(`✅ Reservation ${reservationId} marked as paid`);
                updateReservationStatus(reservationId, 'paid');
            } catch (err) {
                alert('❌ Failed to approve reservation');
                console.error(err);
            }
        }

        async function rejectReservation(reservationId) {
            const reservation = reservations.find(r => r.idReservation == reservationId);
            if (reservation) {
                if (confirm(`Are you sure you want to reject reservation ${reservationId}?`)) {
                    try {
                        await fetch(`/api/payments/${reservationId}/reject`, {
                            method: 'PUT',
                            headers: {
                                'Authorization': `Bearer ${localStorage.getItem('token')}`
                            }
                        });
                        alert(`❌ Reservation ${reservationId} rejected successfully`);
                        updateReservationStatus(reservationId, 'rejected');
                    } catch (error) {
                        alert('❌ Failed to reject reservation');
                        console.error(error);
                    }
                }
            }
        }

        function showReservationDetails(reservationId) {
            const reservation = reservations.find(r => r.idReservation == reservationId);
            const detailsCard = document.getElementById('reservationDetailsCard');
            const detailsContent = document.getElementById('reservationDetailsContent');

            if (reservation && detailsCard && detailsContent) {
                let statusText = reservation.statutPaiement;
                if (reservation.statutPaiement === 'paid') statusText = 'Approved';
                else if (reservation.statutPaiement === 'unpaid') statusText = 'Pending';
                else if (reservation.statutPaiement === 'rejected') statusText = 'Rejected';

                detailsContent.innerHTML = `
        <div class="reservation-details">
          <p><strong>Reservation ID:</strong> ${reservation.idReservation}</p>
          <p><strong>Passenger:</strong> ${reservation.passagerNom || 'N/A'} ${reservation.passagerPrenom || ''}</p>
          <p><strong>Trip:</strong> ${reservation.depart || 'N/A'} → ${reservation.destination || 'N/A'}</p>
          <p><strong>Departure Time:</strong> ${reservation.heureDepart || 'N/A'}</p>
          <p><strong>Reservation Date:</strong> ${reservation.dateReservation ? new Date(reservation.dateReservation).toLocaleDateString() : 'N/A'}</p>
          <p><strong>Seats:</strong> ${reservation.nbrPlaces || 1}</p>
          <p><strong>Payment Status:</strong> ${statusText}</p>
        </div>
        ${reservation.statutPaiement === 'unpaid' ? `
        <div class="reservation-details-actions">
            <button class="btn btn-success approve-btn-modal" data-id="${reservation.idReservation}" title="Approve Payment">
              <i class="bi bi-check-circle-fill"></i> Approve
            </button>
            <button class="btn btn-danger reject-btn-modal" data-id="${reservation.idReservation}" title="Reject Payment">
              <i class="bi bi-x-circle-fill"></i> Reject
            </button>
        </div>` : ''}
      `;

      detailsCard.style.display = 'block';
      // Scroll to the details card if it's out of view
      detailsCard.scrollIntoView({ behavior: 'smooth', block: 'nearest' }); 

      // Re-attach handlers for buttons inside modal/details card
      const approveBtnModal = detailsContent.querySelector('.approve-btn-modal');
      if (approveBtnModal) {
        approveBtnModal.addEventListener('click', function () {
          approveReservation(this.getAttribute('data-id'));
          detailsCard.style.display = 'none';
        });
      }
      const rejectBtnModal = detailsContent.querySelector('.reject-btn-modal');
      if (rejectBtnModal) {
        rejectBtnModal.addEventListener('click', function () {
          rejectReservation(this.getAttribute('data-id'));
          detailsCard.style.display = 'none';
        });
      }
    }
  }

  document.getElementById('closeDetailsBtn').addEventListener('click', function () {
    document.getElementById('reservationDetailsCard').style.display = 'none';
  });

  document.getElementById('filterStatus').addEventListener('change', function () {
    loadReservations(this.value);
  });

  document.getElementById('searchReservations').addEventListener('input', function () {
    // Debounce search for better performance if needed, for now direct filtering
    loadReservations(document.getElementById('filterStatus').value);
  });

  // User dropdown toggle
  const userInfoEl = document.getElementById('userInfo');
  const userDropdownEl = document.getElementById('userDropdown');
  if (userInfoEl && userDropdownEl) {
      userInfoEl.addEventListener('click', function (e) {
        e.stopPropagation(); // Prevent click from bubbling to document
        userDropdownEl.classList.toggle('active');
      });
  }
  // Close dropdown if clicked outside
  document.addEventListener('click', function (e) {
    if (userDropdownEl && userDropdownEl.classList.contains('active') && !userInfoEl.contains(e.target)) {
      userDropdownEl.classList.remove('active');
    }
  });

  // Logout
  const logoutBtnEl = document.getElementById('logoutBtn');
  if (logoutBtnEl) {
      logoutBtnEl.addEventListener('click', function (e) {
        e.preventDefault();
        if (confirm('Are you sure you want to logout?')) {
          localStorage.removeItem('token');
          window.location.href = 'login'; // Adjust to your login page
        }
      });
  }
    </script>

</body>

</html>